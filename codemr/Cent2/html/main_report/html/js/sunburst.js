codemr.sunburst=function(){metricChartManagerForClass=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),metricChartManagerForPackage=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues),codemr.sunburst.paintCallBack=function(){h.style("fill",(function(t){return u(t)}))};var t=0,e=null,n=Math.min(800,800)/2,r=d3.scale.linear().range([0,2*Math.PI]),a=d3.scale.linear().range([0,n]),i=(d3.scale.category20c(),!0);d3.select("#sunburst-chart-body").on("mousemove",(function(){i||(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1)),i=!1}));var o=d3.select("#sunburst-chart-body").append("svg").attr("width",800).attr("height",800).attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 800 800").append("g").attr("transform","translate(400,400)"),c=d3.layout.partition().value((function(t){return t.value})),s=d3.svg.arc().startAngle((function(t){return Math.max(0,Math.min(2*Math.PI,r(t.x)))})).endAngle((function(t){return Math.max(0,Math.min(2*Math.PI,r(t.x+t.dx)))})).innerRadius((function(t){return Math.max(0,a(t.y))})).outerRadius((function(t){return Math.max(0,a(t.y+t.dy))}));function u(t){return EQ_GET_COLOR(t)}function l(n){return t+1>=n.depth==0||null!=e&&0==function t(e,n){if(e===n)return!0;if(e.children)return e.children.some((function(e){return t(e,n)}));return!1}(e,n)||Math.max(0,a(n.y))*(Math.min(2*Math.PI,r(n.x+n.dx))-Math.min(2*Math.PI,r(n.x)))<14?"hidden":"visible"}function d(e){if(t+1>=e.depth){0;var n=e.name,r=n.indexOf(".");return n.substring(r+1)}return""}var m=d3.select("#sunburst-tooltip");root=EQ_GET_DATA();{var p=o.selectAll("g").data(c.nodes(root)).enter().append("g");d3.select("g").append("svg:image").attr("x",-78).attr("y",-78).attr("width",156).attr("height",156).on("mouseover",(function(){d3.select(this).moveToBack()}));var h=p.append("path").attr("d",s).style("fill",(function(t){return u(t)})).on("click",g).on("mouseover",b).on("mouseout",x).on("mousemove",y),f=p.append("text").attr("text-anchor",(function(t){return E(t)?"start":"end"})).attr("pointer-events","none").attr("transform",(function(t){return"rotate("+C(t)+")translate("+a(t.y)+")rotate("+(E(t)?"0":"-180")+")"})).attr("dx",(function(t){return E(t)?"5":"-5"})).attr("dy",".35em").text(d).style("visibility",(function(t){return l(t)})).on("click",g).on("mouseover",b).on("mouseout",x).on("mousemove",y);function g(i){e!==i&&(t=i.depth,e=i,f.transition().attr("opacity",0).style("visibility",(function(t){return l(t)})).style("pointer-events","none"),h.transition().duration(750).attrTween("d",function(t){var e=d3.interpolate(r.domain(),[t.x,t.x+t.dx]),i=d3.interpolate(a.domain(),[t.y,1]),o=d3.interpolate(a.range(),[t.y?20:0,n]);return function(t,n){return n?function(e){return s(t)}:function(n){return r.domain(e(n)),a.domain(i(n)).range(o(n)),s(t)}}}(i)).each("end",(function(t,e){if(t.x>=i.x&&t.x<i.x+i.dx){var n=d3.select(this.parentNode).select("text");n.transition().duration(750).attr("opacity",1).attr("text-anchor",(function(t){return E(t)?"start":"end"})).attr("transform",(function(){return"rotate("+C(t)+")translate("+a(t.y)+")rotate("+(E(t)?"0":"-180")+")"})).attr("dx",(function(t){return E(t)?"5":"-5"})),n.text(d).style("visibility",(function(t){return l(t)}))}})))}function y(t){m.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px"),v(t),function(t){i=!0,elem=document.getElementById("sunburst-chart-body"),boundingRect=elem.getBoundingClientRect();v(t);var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,r=d3.event.pageX,a=d3.event.pageY,o=metricChartManagerForClass.getWidth();if(d3.event.pageX>boundingRect.left+400){var c=e-r;r<o&&(c=e-o),d3.select("#sunburst-tooltip").style("right",c+"px"),d3.select("#sunburst-tooltip").style("left","auto")}else{var s=r;r+o>e&&(s=e-o),d3.select("#sunburst-tooltip").style("left",s+"px"),d3.select("#sunburst-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+400?(d3.select("#sunburst-tooltip").style("bottom",n-a+"px"),d3.select("#sunburst-tooltip").style("top","auto")):(d3.select("#sunburst-tooltip").style("top",a+"px"),d3.select("#sunburst-tooltip").style("bottom","auto"))}(t)}function v(t){d3.event.ctrlKey||d3.event.metaKey?!function(t){return!t.children}(t)?function(t){return!(!t.children||!t.parent)}(t)&&(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!0)):(metricChartManagerForClass.setVisible(!0),metricChartManagerForPackage.setVisible(!1)):(metricChartManagerForClass.setVisible(!1),metricChartManagerForPackage.setVisible(!1))}d3.select("g g").transition().duration(200).attr("opacity","0"),d3.select("g g").transition().duration(200).attr("opacity","1"),d3.selection.prototype.moveToBack=function(){return this.each((function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)}))};var M=null;function b(t){return m.select("#name").html((function(){return function(t){return"<b>"+t.name+"</b><br>"+EQ_getSelectedMetricName(t)+":"+EQ_GET_METRICVALUE(t)+"<br>Level:"+EQ_GET_METRIC_LEVEL_STR(t)}(t)})),M!==t&&(t.metrics?metricChartManagerForClass.updateMetricValues(EQ_convertMetricValues(t.metricvalues)):t.pmetrics&&metricChartManagerForPackage.updateMetricValues(EQ_convertMetricValues(t.pmetricvalues)),M=t,"function"==typeof updateSelectedElement&&t.parent&&(t.key?updateSelectedElement(t.parent.name,t.key):updateSelectedElement(t.name,""))),v(t),m.transition().duration(50).style("opacity",.9)}function x(t){0}}function C(n){return n===e||0===t&&0===n.depth?0:(r(n.x+n.dx/2)-Math.PI/2)/Math.PI*180}function E(t){var e=C(t);return e<0&&(e+=360),!(e>90&&e<=270)}d3.select(self.frameElement).style("height","850px")};
