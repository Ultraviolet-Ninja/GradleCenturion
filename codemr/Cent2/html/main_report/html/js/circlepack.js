codemr.circlepack=function(){var e=codemr.metricchart("class-metric-chart",classMetricSpec,classMetricValues),t=codemr.metricchart("package-metric-chart",packageMetricSpec,packageMetricValues);codemr.circlepack.paintCallBack=function(){d.style("fill",(function(e){return e.children?"#C6DCEC":n(e)})),d.selectAll("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}))};function n(e){return EQ_GET_COLOR(e)}function c(e){var t=e.name,n=t.indexOf(".");return t.substring(n+1)}var r=d3.layout.pack().padding(2).size([780,780]).value((function(e){return e.value})).sort((function(e,t){var n;n=t.value-e.value;return n}));var i=d3.select("#circle-chart-body").append("div").attr("class","circlepackchart").append("svg").attr("width",800).attr("height",800).append("g").attr("transform","translate(400,400)");root=EQ_GET_DATA();{var l,a=root,o=r.nodes(root),s=i.selectAll("circle").data(o).enter().append("circle"),u=null,d=s.attr("class",(function(e){return e.parent?e.children?"node":"node node--leaf":"node node--root"})).style("fill",(function(e){return e.children?"#C6DCEC":n(e)})).style("fill-opacity",(function(e){return e.children?"0.5":"0.9"})).style("stroke",(function(e){return"#000"})).on("click",(function(e){a!==e&&(f(e),d3.event.stopPropagation())})).on("mousemove",(function(n){u!==n&&(n.metrics?e.updateMetricValues(EQ_convertMetricValues(n.metricvalues)):n.pmetrics&&t.updateMetricValues(EQ_convertMetricValues(n.pmetricvalues)),u=n,"function"==typeof updateSelectedElement&&n.parent&&(n.key?updateSelectedElement(n.parent.name,n.key):updateSelectedElement(n.name,""))),v(n),function(t){movingOnElement=!0,elem=document.getElementById("circle-chart-body"),boundingRect=elem.getBoundingClientRect();var n=e.getWidth();v(t);var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=d3.event.pageX,l=d3.event.pageY;if(d3.event.pageX>boundingRect.left+400){var a=c-i;i<n&&(a=c-n),d3.select("#circle-pack-tooltip").style("right",a+"px"),d3.select("#circle-pack-tooltip").style("left","auto")}else{var o=i;i+n>c&&(o=c-n),d3.select("#circle-pack-tooltip").style("left",o+"px"),d3.select("#circle-pack-tooltip").style("right","auto")}d3.event.pageY>boundingRect.top+400?(d3.select("#circle-pack-tooltip").style("bottom",r-l+"px"),d3.select("#circle-pack-tooltip").style("top","auto")):(d3.select("#circle-pack-tooltip").style("top",l+"px"),d3.select("#circle-pack-tooltip").style("bottom","auto"))}(n)}));s.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var p=i.selectAll("text").data(o).enter().append("text");p.attr("class","circlelabel").style("display",(function(e){return e.parent===root?null:"none"})).text((function(e){return c(e)}));p.append("title").text((function(e){return e.name+" "+EQ_getSelectedMetricName(e)+" "+EQ_GET_METRICVALUE(e)}));var m=i.selectAll("circle,text");function f(e){a=e,d3.transition().duration(d3.event.altKey?7500:750).tween("zoom",(function(e){var t=d3.interpolateZoom(l,[a.x,a.y,2*a.r+20]);return function(e){y(t(e))}})).selectAll("text").filter((function(e){return!!e&&(e.parent===a||"inline"===this.style.display)})).style("fill-opacity",(function(e){return e.parent===a?1:0})).each("start",(function(e){e.parent===a&&(this.style.display="inline")})).each("end",(function(e){e.parent!==a&&(this.style.display="none")})),e.metrics&&eQ.MetricChart.updateDots(e.metrics,c(e))}d3.select("body").on("click",(function(){f(root)})),y([root.x,root.y,2*root.r+20])}function y(e){var t=800/e[2];l=e,m.attr("transform",(function(n){return"translate("+(n.x-e[0])*t+","+(n.y-e[1])*t+")"})),d.attr("r",(function(e){return e.r*t}))}function v(n){d3.event.ctrlKey||d3.event.metaKey?!function(e){return!e.children}(n)?function(e){return!(!e.children||!e.parent)}(n)&&(e.setVisible(!1),t.setVisible(!0)):(e.setVisible(!0),t.setVisible(!1)):(e.setVisible(!1),t.setVisible(!1))}d3.select(self.frameElement).style("height","850px")};
