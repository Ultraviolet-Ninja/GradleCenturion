<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChordQualities.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cent2</a> &gt; <a href="index.source.html" class="el_package">bomb.modules.c</a> &gt; <span class="el_source">ChordQualities.java</span></div><h1>ChordQualities.java</h1><pre class="source lang-java linenums">package bomb.modules.c;

import bomb.modules.s.Souvenir;
import bomb.enumerations.Qualities;
import bomb.enumerations.Roots;
import bomb.Widget;

import static bomb.tools.Mechanics.NUMBER_REGEX;
import static bomb.tools.Mechanics.ultimateFilter;
//TODO - Probably rename some variables and make the Javadocs

/**
 * This class deals with the Chord Qualities module.
 */
<span class="nc" id="L15">public class ChordQualities extends Widget {</span>
    private static final String[]
<span class="fc" id="L17">            ALL_NOTES = new String[]{&quot;A&quot;, &quot;A#&quot;, &quot;B&quot;, &quot;C&quot;, &quot;C#&quot;, &quot;D&quot;, &quot;D#&quot;, &quot;E&quot;, &quot;F&quot;, &quot;F#&quot;, &quot;G&quot;, &quot;G#&quot;},</span>

<span class="fc" id="L19">    DISTANCES = new String[]{&quot;4,3,3&quot;, &quot;3,4,3&quot;, &quot;4,3,4&quot;, &quot;3,4,4&quot;,</span>
            &quot;3,1,6&quot;, &quot;3,3,4&quot;, &quot;2,2,3&quot;, &quot;2,1,4&quot;, &quot;4,4,2&quot;, &quot;4,4,3&quot;, &quot;5,2,3&quot;, &quot;3,5,3&quot;};

    /**
     * @param input
     * @return
     */
    public static String solve(String input) throws IllegalArgumentException {
<span class="fc" id="L27">        String[] og = originalInfo(input);</span>
<span class="fc" id="L28">        return &quot;New Chord: &quot; + getNextRoot(Integer.parseInt(og[1])) + &quot; &quot; + getNextQuality(og[0]);</span>
    }

    /**
     * @param input
     * @return
     * @throws IllegalArgumentException
     */
    private static String[] originalInfo(String input) throws IllegalArgumentException {
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">        if (souvenir) Souvenir.addRelic(&quot;Chord Quality Notes&quot;, input);</span>

<span class="fc" id="L39">        String temp = noteConvert(input);</span>
<span class="fc" id="L40">        String[] outputs = new String[2];</span>
<span class="fc" id="L41">        int[] traits = originalQuality(combinations(temp));</span>
<span class="fc" id="L42">        outputs[0] = getOriginalRoot(traits[1], input);</span>
<span class="fc" id="L43">        outputs[1] = String.valueOf(traits[0]);</span>
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">        if (souvenir) Souvenir.addRelic(&quot;Chord Quality (Original)&quot;, getChord(traits[0]));</span>
<span class="fc" id="L45">        return outputs;</span>
    }

    /**
     * @param notes
     * @return
     * @throws IllegalArgumentException
     */
    private static String noteConvert(String notes) throws IllegalArgumentException {
        //TODO - Break down
<span class="fc" id="L55">        StringBuilder output = new StringBuilder();</span>
<span class="fc" id="L56">        String[] noteArray = notes.split(&quot; &quot;),</span>
<span class="fc" id="L57">                order = newOrder(findFirst(noteArray[0]));</span>

<span class="fc" id="L59">        int distance = 1, noteCount = 1, totalDistance = 0;</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">        for (int i = 1; i &lt; order.length; i++) {</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">            if (noteArray[noteCount].equals(order[i])) {</span>
<span class="fc" id="L62">                output.append(distance).append(&quot;,&quot;);</span>
<span class="fc" id="L63">                totalDistance += distance;</span>
<span class="fc" id="L64">                distance = 1;</span>
<span class="fc" id="L65">                noteCount++;</span>
            } else
<span class="fc" id="L67">                distance++;</span>

<span class="fc bfc" id="L69" title="All 2 branches covered.">            if (noteCount == 4) {</span>
<span class="fc" id="L70">                i = order.length;</span>
<span class="fc" id="L71">                output.append(order.length - totalDistance);</span>
            }
        }

<span class="fc bfc" id="L75" title="All 2 branches covered.">        if (ultimateFilter(output.toString(), NUMBER_REGEX).length() != 4)</span>
<span class="fc" id="L76">            throw new IllegalArgumentException(&quot;There shouldn't be any duplicate notes&quot;);</span>
<span class="fc" id="L77">        return output.toString();</span>
    }

    /**
     * @param given
     * @return
     * @throws IllegalArgumentException
     */
    private static int findFirst(String given) throws IllegalArgumentException {
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">        for (int i = 0; i &lt; ALL_NOTES.length; i++) {</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            if (given.equals(ALL_NOTES[i]))</span>
<span class="fc" id="L88">                return i;</span>
        }
<span class="nc" id="L90">        throw new IllegalArgumentException();</span>
    }

    /**
     * @param first
     * @return
     */
    private static String[] newOrder(int first) {
<span class="fc" id="L98">        String[] order = new String[ALL_NOTES.length];</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">        for (int i = 0; i &lt; order.length; i++) {</span>
<span class="fc" id="L100">            order[i] = ALL_NOTES[first++];</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">            if (first == ALL_NOTES.length)</span>
<span class="fc" id="L102">                first = 0;</span>
        }
<span class="fc" id="L104">        return order;</span>
    }

    /**
     * @param distances
     * @return
     */
    private static String[] combinations(String distances) {
<span class="fc" id="L112">        String[] outputs = new String[4];</span>
<span class="fc" id="L113">        outputs[0] = distances;</span>
<span class="fc" id="L114">        outputs[1] = reorder(distances);</span>
<span class="fc" id="L115">        outputs[2] = reorder(outputs[1]);</span>
<span class="fc" id="L116">        outputs[3] = reorder(outputs[2]);</span>
<span class="fc" id="L117">        return outputs;</span>
    }

    /**
     * @param sample
     * @return
     */
    private static String reorder(String sample) {
<span class="fc" id="L125">        return sample.substring(2) + &quot;,&quot; + sample.charAt(0);</span>
    }

    /**
     * @param combos
     * @return
     * @throws IllegalArgumentException
     */
    private static int[] originalQuality(String[] combos) throws IllegalArgumentException {
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">        for (int idx = 0; idx &lt; DISTANCES.length; idx++) {</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">            for (int jdx = 0; jdx &lt; combos.length; jdx++)</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">                if (combos[jdx].startsWith(DISTANCES[idx]))</span>
<span class="fc" id="L137">                    return new int[]{idx, jdx};</span>
        }
<span class="nc" id="L139">        throw new IllegalArgumentException(&quot;This shouldn't occur in originalQuality()&quot;);</span>
    }

    private static String getOriginalRoot(int which, String notes) {
<span class="fc" id="L143">        return notes.split(&quot; &quot;)[which];</span>
    }

    /**
     * @param note
     * @return
     * @throws IllegalArgumentException
     */
    private static String getNextQuality(String note) throws IllegalArgumentException {
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">        for (Roots current : Roots.values()) {</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">            if (note.equals(current.getNote()))</span>
<span class="fc" id="L154">                return current.getLabel();</span>
        }
<span class="nc" id="L156">        throw new IllegalArgumentException(&quot;This shouldn't reach this exception&quot;);</span>
    }

    /**
     * @param quality
     * @return
     */
    private static String getNextRoot(int quality) {
<span class="fc" id="L164">        return Qualities.values()[quality].getLabel();</span>
    }

    /**
     * @param position
     * @return
     */
    private static String getChord(int position) {
<span class="nc bnc" id="L172" title="All 12 branches missed.">        switch (position) {</span>
<span class="nc" id="L173">            case 0: return &quot;7&quot;;</span>
<span class="nc" id="L174">            case 1: return &quot;-7&quot;;</span>
<span class="nc" id="L175">            case 2: return &quot;Î”7&quot;;</span>
<span class="nc" id="L176">            case 3: return &quot;-Î”7&quot;;</span>
<span class="nc" id="L177">            case 4: return &quot;7#9&quot;;</span>
<span class="nc" id="L178">            case 5: return &quot;Ã˜&quot;;</span>
<span class="nc" id="L179">            case 6: return &quot;add9&quot;;</span>
<span class="nc" id="L180">            case 7: return &quot;-add9&quot;;</span>
<span class="nc" id="L181">            case 8: return &quot;7#5&quot;;</span>
<span class="nc" id="L182">            case 9: return &quot;Î”7#5&quot;;</span>
<span class="nc" id="L183">            case 10: return &quot;7sus&quot;;</span>
<span class="nc" id="L184">            default: return &quot;-Î”7#5&quot;;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>