<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Astrology.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Cent2</a> &gt; <a href="index.source.html" class="el_package">bomb.modules.ab</a> &gt; <span class="el_source">Astrology.java</span></div><h1>Astrology.java</h1><pre class="source lang-java linenums">package bomb.modules.ab;

import bomb.Widget;
import bomb.enumerations.AstroSymbols;

import static bomb.tools.Mechanics.LOWERCASE_REGEX;
import static bomb.tools.Mechanics.ultimateFilter;

/**
 * This class deals with the Astrology module. This module displays three different astrological symbols
 * that pertain to a particular index in the 3 2D arrays. These symbols will point to a particular number in
 * each array that'll be added up to determine the Omen that needs to be pressed.
 * (Good if positive, Bad if negative or No Omen if 0)
 * The quantity of the number is used to determine when to press the button.
 * (i.e. Bad Omen at 5 means that you need to press &quot;Bad Omen&quot; when the bomb timer has a 5 in it)
 */
<span class="nc" id="L17">public class Astrology extends Widget {</span>
    public static final int ELEMENT_INDEX = 0, CELESTIAL_INDEX = 1, ZODIAC_INDEX = 2, EXPECTED_SIZE = 3;
    public static final String GOOD_OMEN = &quot;Good Omen at &quot;, POOR_OMEN = &quot;Poor Omen at &quot;, NO_OMEN = &quot;No Omen&quot;;

<span class="fc" id="L21">    private static final int[][] stage1 = {{0,0,1,-1,0,1,-2,2,0,-1}, {-2,0,-1,0,2,0,-2,2,0,1},</span>
            {-1,-1,0,-1,1,2,0,2,1,-2}, {-1,2,-1,0,-2,-1,0,2,-2,2}},

<span class="fc" id="L24">            stage2 = {{1,0,-1,0,0,2,2,0,1,0,1,0}, {2,2,-1,2,-1,-1,-2,1,2,0,0,2},</span>
                    {-2,-1,0,0,1,0,1,2,-1,-2,1,1}, {1,1,-2,-2,2,0,-1,1,0,0,-1,-1}},

<span class="fc" id="L27">            stage3 = {{-1,-1,2,0,-1,0,-1,1,0,0,-2,-2}, {-2,0,1,0,2,0,-1,1,2,0,1,0},</span>
                    {-2,-2,-1,-1,1,-1,0,-2,0,0,-1,1}, {-2,2,-2,0,0,1,-1,0,2,-2,-1,1},
                    {-2,0,-1,-2,-2,-2,-1,1,1,1,0,-1}, {-1,-2,1,-1,0,0,0,1,0,-1,2,0},
                    {-1,-1,0,0,1,1,0,0,0,0,-1,-1}, {-1,2,0,0,1,-2,1,0,2,-1,1,0},
                    {1,0,2,1,-1,1,1,1,0,-2,2,0}, {-1,0,0,-1,-2,1,2,1,1,0,0,-1}};

    /**
     * Calculates the phrase composed of the Omen to press and when to press it
     *
     * @param symbols The input symbols
     * @throws IllegalArgumentException Serial code is empty or there's an issue with the amount of symbols
     * @return The String command
     */
    public static String calculate(AstroSymbols ... symbols)
            throws IllegalArgumentException{
<span class="fc" id="L42">        checkThreeTypes(symbols);</span>
<span class="fc" id="L43">        AstroSymbols[] sortSymbols = sort(symbols);</span>

<span class="fc" id="L45">        int first = stage1[sortSymbols[ELEMENT_INDEX].getIdx()][sortSymbols[CELESTIAL_INDEX].getIdx()],</span>
<span class="fc" id="L46">                second = stage2[sortSymbols[ELEMENT_INDEX].getIdx()][sortSymbols[ZODIAC_INDEX].getIdx()],</span>
<span class="fc" id="L47">                third = stage3[sortSymbols[CELESTIAL_INDEX].getIdx()][sortSymbols[ZODIAC_INDEX].getIdx()];</span>

<span class="fc" id="L49">        int results = first + second + third;</span>
<span class="fc" id="L50">        results = checkMatchingSerialLetters(results, sortSymbols);</span>

<span class="fc bfc" id="L52" title="All 4 branches covered.">        return results &gt; 0 ?</span>
                GOOD_OMEN + results :
                (results == 0 ?
                        NO_OMEN :
<span class="fc" id="L56">                        POOR_OMEN + Math.abs(results));</span>
    }

    /**
     * Checks the current set of symbols and compares them to letters in the Serial Code.
     * If the symbol has a letter that matches a letter in the Serial Code, it adds one to
     * the output value. If not, it'll subtract 1
     *
     * @param initialVal The output value
     * @param symbols The set of AstroSymbols
     * @return The resulting output value
     * @throws IllegalArgumentException The Serial Code is empty
     */
    private static int checkMatchingSerialLetters(int initialVal, AstroSymbols[] symbols)
            throws IllegalArgumentException{
<span class="fc bfc" id="L71" title="All 2 branches covered.">        if (serialCode.isEmpty()) throw new IllegalArgumentException(&quot;Serial Code is required&quot;);</span>

<span class="fc" id="L73">        String letters = ultimateFilter(serialCode, LOWERCASE_REGEX);</span>
<span class="fc bfc" id="L74" title="All 2 branches covered.">        for (AstroSymbols symbol : symbols){</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">            if (ultimateFilter(symbol.name(), letters).isEmpty()) initialVal--;</span>
<span class="fc" id="L76">            else initialVal++;</span>
        }
<span class="fc" id="L78">        return initialVal;</span>
    }

    private static void checkThreeTypes(AstroSymbols[] symbols) throws IllegalArgumentException{
<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (symbols.length != EXPECTED_SIZE)</span>
<span class="fc" id="L83">            throw new IllegalArgumentException(&quot;Astrology input size should be &quot; + EXPECTED_SIZE);</span>
<span class="fc" id="L84">        containsOneOfEach(symbols);</span>
<span class="fc" id="L85">    }</span>

    private static void containsOneOfEach(AstroSymbols[] symbols) throws IllegalArgumentException{
<span class="fc" id="L88">        containsOneCelestial(symbols);</span>
<span class="fc" id="L89">        containsOneElement(symbols);</span>
<span class="fc" id="L90">        containsOneZodiac(symbols);</span>
<span class="fc" id="L91">    }</span>

    private static void containsOneCelestial(AstroSymbols[] symbols){
<span class="fc" id="L94">        int count = 0;</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">        for (AstroSymbols symbol : symbols)</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">            if (isCelestial(symbol)) count++;</span>
<span class="pc bpc" id="L97" title="1 of 2 branches missed.">        if (count &gt; 1) throw new IllegalArgumentException(&quot;Only one celestial body allowed&quot;);</span>
<span class="fc" id="L98">    }</span>

    private static void containsOneElement(AstroSymbols[] symbols){
<span class="fc" id="L101">        int count = 0;</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">        for (AstroSymbols symbol : symbols)</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">            if (isElemental(symbol)) count++;</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (count &gt; 1) throw new IllegalArgumentException(&quot;Only one element allowed&quot;);</span>
<span class="fc" id="L105">    }</span>

    private static void containsOneZodiac(AstroSymbols[] symbols){
<span class="fc" id="L108">        int count = 0;</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">        for (AstroSymbols symbol : symbols)</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">            if (isZodiac(symbol)) count++;</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">        if (count &gt; 1) throw new IllegalArgumentException(&quot;Only one zodiac allowed&quot;);</span>
<span class="fc" id="L112">    }</span>

    private static AstroSymbols[] sort(AstroSymbols[] symbols){
<span class="fc" id="L115">        AstroSymbols[] output = new AstroSymbols[symbols.length];</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">        for (AstroSymbols symbol : symbols){</span>
<span class="fc bfc" id="L117" title="All 2 branches covered.">            if (isElemental(symbol)) output[ELEMENT_INDEX] = symbol;</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">            else if (isCelestial(symbol)) output[CELESTIAL_INDEX] = symbol;</span>
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">            else if (isZodiac(symbol)) output[ZODIAC_INDEX] = symbol;</span>
        }
<span class="fc" id="L121">        return output;</span>
    }

    private static boolean isZodiac(AstroSymbols symbol){
<span class="fc bfc" id="L125" title="All 2 branches covered.">        switch (symbol){</span>
            case ARIES:
            case TAURUS:
            case GEMINI:
            case CANCER:
            case LEO:
            case VIRGO:
            case LIBRA:
            case SCORPIO:
            case SAGITTARIUS:
            case CAPRICORN:
            case AQUARIUS:
            case PISCES:
<span class="fc" id="L138">                return true;</span>
        }
<span class="fc" id="L140">        return false;</span>
    }

    private static boolean isCelestial(AstroSymbols symbol){
<span class="fc bfc" id="L144" title="All 2 branches covered.">        switch (symbol){</span>
            case SUN:
            case MOON:
            case MERCURY:
            case VENUS:
            case MARS:
            case JUPITER:
            case SATURN:
            case URANUS:
            case NEPTUNE:
            case PLUTO:
<span class="fc" id="L155">                return true;</span>
        }
<span class="fc" id="L157">        return false;</span>
    }

    private static boolean isElemental(AstroSymbols symbol){
<span class="fc bfc" id="L161" title="All 2 branches covered.">        switch (symbol){</span>
            case FIRE:
            case EARTH:
            case AIR:
            case WATER:
<span class="fc" id="L166">                return true;</span>
        }
<span class="fc" id="L168">        return false;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>